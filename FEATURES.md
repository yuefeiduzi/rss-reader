# 功能文档

## 概述

这是一个 Flutter 跨平台 RSS 阅读器应用，支持 iOS、Android、macOS、Windows、Linux 和 Web 平台。

---

## 一、订阅源管理

| 功能点 | 说明 |
|--------|------|
| 添加 RSS/Atom 订阅源 | 支持手动输入 URL，自动补全 `http://` 前缀 |
| 预设热门订阅源 | Hacker News、Dribbble、The Verge、TechCrunch、GitHub Blog |
| 验证订阅源格式 | URL 格式校验，解析 RSS/Atom 格式 |
| 删除订阅源 | 确认后删除，同时删除关联文章 |
| 置顶订阅源 | 长按订阅源可置顶，优先显示 |
| 按添加时间排序 | 新添加的排在前面 |
| 未读文章计数 | 每个订阅源显示未读文章数量 |

---

## 二、文章阅读

| 功能点 | 说明 |
|--------|------|
| 文章列表展示 | 卡片式布局，显示标题、摘要、头图、作者、时间 |
| 未读/已读标记 | 蓝色圆点标记未读文章，显示标签 |
| 收藏功能 | 点击爱心收藏文章 |
| 下拉刷新 | 手动刷新获取最新文章 |
| 自动加载缓存 | 先显示缓存，后台刷新 |
| 清除缓存刷新 | 清除缓存后重新抓取 |
| 图片懒加载 | 网络图片按需加载 |
| 纯文本摘要提取 | 自动从 HTML 提取 100 字摘要 |
| 相对时间显示 | X分钟前、X小时前、X天前 |

---

## 三、文章详情

| 功能点 | 说明 |
|--------|------|
| 全文阅读 | HTML 内容渲染，支持图片显示 |
| 收藏切换 | 红心按钮收藏/取消收藏 |
| 外部浏览器打开 | 使用系统浏览器打开原文链接 |
| 分享功能 | 分享文章标题和链接 |
| 图片预览 | 点击图片全屏预览，支持双指缩放、平移 |
| HTML 内容解析 | 支持 p/img/a/strong/em/blockquote/h1-h3/ul/li/code/pre 等标签 |

---

## 四、主题与外观

| 功能点 | 说明 |
|--------|------|
| 浅色主题 | 亮色模式 |
| 暗色主题 | 深色模式 |
| 跟随系统 | 自动跟随系统主题设置 |
| 快速切换 | 首页右上角一键切换主题 |
| Material 3 设计 | 使用 Material 3 设计语言 |
| 卡片圆角 | 统一 12px 圆角设计 |

---

## 五、响应式布局

| 功能点 | 说明 |
|--------|------|
| 窄屏单页布局 | 移动端：列表 → 文章列表 → 文章详情 导航 |
| 宽屏分栏布局 | 桌面端：左侧订阅源列表，右侧文章列表/详情并列 |
| 动态面板宽度 | 根据屏幕宽度自动调整左侧面板 (250-320px) |

---

## 六、数据存储

| 功能点 | 说明 |
|--------|------|
| SharedPreferences 存储 | 轻量级本地存储 |
| Feed 持久化 | 订阅源列表本地保存 |
| Article 持久化 | 文章列表本地保存 |
| 配置持久化 | 主题设置等配置保存 |
| 过期文章清理 | 自动清理 30 天前的非收藏文章 |

---

## 七、缓存管理

| 功能点 | 说明 |
|--------|------|
| 文章内容缓存 | 全文抓取后缓存，7天过期 |
| 缓存过期管理 | 自动清理过期缓存 |
| 缓存统计 | 获取缓存文章/图片数量 |
| 清除全部缓存 | 一键清空缓存 |

---

## 八、备份恢复

| 功能点 | 说明 |
|--------|------|
| JSON 备份 | 导出所有数据为 JSON 文件 |
| OPML 导出 | 导出订阅源为 OPML 格式（其他阅读器兼容） |
| JSON 恢复 | 从 JSON 备份文件恢复 |
| OPML 导入 | 从 OPML 文件导入订阅源 |
| 自动双备份 | 同时生成 JSON 和 OPML 备份文件 |
| 备份文件管理 | 自动按时间戳命名，支持列出备份文件 |

---

## 九、RSS 解析

| 功能点 | 说明 |
|--------|------|
| RSS 格式解析 | 支持 RSS 2.0/1.0 |
| Atom 格式解析 | 支持 Atom 1.0 |
| CDATA 处理 | 自动移除 CDATA 区块 |
| HTML 实体解码 | 解码 `&nbsp;` `&amp;` `&lt;` `&gt;` 等 |
| 图片提取 | 自动从文章内容提取头图 |
| 自定义 User-Agent | 模拟浏览器请求 |

---

## 十、全文抓取

| 功能点 | 说明 |
|--------|------|
| 智能内容提取 | 自动识别 article/post-content/article-content 等选择器 |
| 广告过滤 | 移除 script/style/nav/footer/header |
| 回退策略 | 未识别到文章区域时使用 body 内容 |

---

## 十一、用户操作清单

### 订阅源管理
- [ ] 添加新订阅源（手动输入/粘贴/预设选择）
- [ ] 删除订阅源
- [ ] 置顶/取消置顶订阅源
- [ ] 查看未读文章数

### 文章阅读
- [ ] 浏览文章列表
- [ ] 标记文章为已读
- [ ] 收藏/取消收藏文章
- [ ] 刷新获取最新内容
- [ ] 清除缓存并刷新
- [ ] 在浏览器中打开原文
- [ ] 分享文章链接

### 个性化
- [ ] 切换浅色/暗色/系统主题

### 数据管理
- [ ] 备份数据（JSON + OPML）
- [ ] 从备份恢复
- [ ] 导入 OPML 订阅源

---

## 十二、技术特性

1. **跨平台支持**：Flutter 构建，支持 6 个平台
2. **离线阅读**：文章缓存本地存储
3. **响应式设计**：自适应移动端和桌面端
4. **全文抓取**：RSS 只显示摘要时自动抓取全文
5. **图片预览**：支持缩放和平移
6. **数据迁移**：支持 OPML 导入导出，与其他阅读器兼容
7. **备份恢复**：完整数据备份，防止数据丢失
8. **Material 3 设计**：现代 UI 设计语言
9. **高效解析**：正则表达式解析 RSS/Atom，无外部 XML 解析依赖

---

## 项目结构

```
lib/
├── main.dart                    # 应用入口
├── models/                      # 数据模型
│   ├── article.dart            # 文章模型
│   ├── feed.dart               # 订阅源模型
│   └── config.dart             # 配置模型
├── services/                    # 业务服务层
│   ├── rss_service.dart        # RSS/Atom 解析服务
│   ├── storage_service.dart    # 本地存储服务
│   ├── cache_service.dart      # 缓存服务
│   ├── theme_service.dart      # 主题管理服务
│   └── backup_service.dart     # 备份/恢复服务
├── ui/                          # 界面层
│   ├── screens/                # 页面
│   │   ├── home_screen.dart
│   │   ├── article_list_screen.dart
│   │   ├── article_detail_screen.dart
│   │   └── settings_screen.dart
│   └── components/             # 组件
│       ├── add_feed_dialog.dart
│       ├── feed_list_tile.dart
│       └── responsive_layout.dart
└── providers/                   # 状态管理
    └── ...
```
